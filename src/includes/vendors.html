<script src="https://cdn.jsdelivr.net/npm/jquery-throttle-debounce/jquery.ba-throttle-debounce.min.js"></script>
<!-- AOS 라이브러리 -->
<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script>
  // 랜딩페이지 단독 스크립트
  $(document).on('ready', function () {
    styleErrorCtl(); // #wrap overflow hidden to sticky
    setScreenSize(); // 100vh
    innerTabUi();
    AOS.init({
      once: true,
    });
    setTimeout(function () {
      slideUi();
    }, 100);
    switchImages();

    $(window).resize(function () {
      switchImages();
    });
  });
  $(window).on('scroll', function () {
    const scrollTop = $(this).scrollTop();
    const $floatingButton = $('.floating-button');

    if (scrollTop > 100) {
      $floatingButton.addClass('position');
    } else {
      $floatingButton.removeClass('position');
    }
  });

  let section06Triggered = false; // 이미 실행했는지 체크
  $(window).on('scroll', function () {
    const section06Top = $('.section06').offset().top;
    const scrollTop = $(this).scrollTop();
    const windowHeight = $(this).height();

    // section06 처음 도달했을 때만 실행
    if (!section06Triggered && scrollTop + windowHeight >= section06Top + windowHeight / 2) {
      section06Triggered = true;

      $('.obj').each(function () {
        const el = $(this);
        const delay = Math.random() * 500; // 0~500ms

        setTimeout(function () {
          el.addClass('on');
        }, delay);
      });
    }
  });

  let groupTriggered = false;

  $(window).on('scroll', function () {
    const $target = $('.section08'); // 기준 요소 변경
    const targetTop = $target.offset().top;
    const targetHeight = $target.outerHeight();
    const scrollTop = $(this).scrollTop();
    const windowHeight = $(this).height();

    // section08 절반 지점
    const triggerPoint = targetTop + targetHeight / 1.5;

    if (!groupTriggered && scrollTop + windowHeight >= triggerPoint) {
      groupTriggered = true;
      $('.section07').addClass('section09');
    } else if (groupTriggered && scrollTop + windowHeight < triggerPoint) {
      groupTriggered = false;
      $('.section07').removeClass('section09');
    }
  });

  function setScreenSize() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  }

  function slideUi() {
    const slideSection08 = new Swiper('.slideSection10', {
      slidesPerView: 1,
      loop: true,
      centeredSlides: true,
      autoplay: {
        delay: 6000,
        disableOnInteraction: false,
      },
      spaceBetween: 30,
      speed: 1000,
      autoHeight: true,
      pagination: {
        el: '.slideSection10 .swiper-pagination',
        clickable: true,
      },
      on: {
        init: function () {
          // setMaxHeight();
        },
      },
    });

    // 반응형 대응 - 창 크기 변경 시 다시 계산
    $(window).on('resize', function () {
      // slideSection08.update(); // Swiper 레이아웃 갱신
      // setMaxHeight(); // 다시 높이 계산
    });

    function setMaxHeight() {
      let maxHeight = 0;
      $('.slideSection10 .swiper-slide').each(function () {
        const h = $(this).outerHeight();
        if (h > maxHeight) maxHeight = h;
      });
      $('.slideSection10 .swiper-wrapper').height(maxHeight);
    }
  }

  function switchImages() {
    $('.responsive').each(function () {
      const $this = $(this);
      const originalSrc = $this.attr('src');
      if (window.innerWidth <= 1024) {
        if (!originalSrc.endsWith('-mo.png') && !originalSrc.endsWith('-mo.jpg')) {
          const newSrc = originalSrc.replace('.png', '-mo.png').replace('.jpg', '-mo.jpg');
          $this.attr('src', newSrc);
        }
        // delay 제거
        $('.aosItem').each(function () {
          $(this).attr('data-aos-delay', '0'); // 딜레이 초기화
        });
      } else {
        const newSrc = originalSrc.replace('-mo.png', '.png').replace('-mo.jpg', '.jpg');
        $this.attr('src', newSrc);
      }
    });
  }

  function styleErrorCtl() {
    $('#wrap').css('overflow', 'inherit');
  }

  function handleAOSResponsive() {
    $('.mobileAos').each(function () {
      const isMobile = window.innerWidth <= 1024;

      if (isMobile && !$(this).hasClass('aosItem')) {
        $(this).addClass('aosItem').attr('data-aos', 'fade-up').attr('data-aos-duration', '1500');
      } else if (!isMobile && $(this).hasClass('aosItem')) {
        $(this).removeClass('aosItem').removeAttr('data-aos').removeAttr('data-aos-duration');
      }
    });

    // 새롭게 추가된 요소도 포함해서 다시 초기화
    AOS.refreshHard(); // refresh보다 완전한 재스캔
  }

  function innerTabUi() {
    const tabTit = $('.inner-tab'),
      tabBtn = tabTit.find('li');

    const tabCnt = $('.tab-content'),
      tabIdx = tabCnt.index();

    // load style settings
    tabCnt.not(':eq(' + tabIdx + ')').hide();
    tabTit.each(function () {
      const defaultTit = $(this).children('li').eq(0);
      defaultTit.addClass('on');
    });
    $('.tab-component').each(function () {
      const defaultCnt = $(this).children('.tab-content').eq(0);
      defaultCnt.addClass('on').show();
    });

    tabBtn.on('click', function (e) {
      if ($(this).attr('rel')) {
        e.preventDefault();

        const $this = $(this),
          thisRel = $this.attr('rel');
        thisClass = $('.' + thisRel);
        thisText = $this.text();
        target = thisClass.parent('.tab-component').attr('id');

        // content connect
        $('#' + target + '>.tab-content')
          .hide()
          .removeClass('on');
        $('#' + target + ' .' + thisRel)
          .show()
          .addClass('on');

        // title styling and attr status
        $this.addClass('on').siblings().removeClass('on');
        thisClass.addClass('on').siblings().removeClass('on');
        $this
          .find('a')
          .attr('title', thisText + 'tab active')
          .parent()
          .siblings()
          .find('a')
          .attr('title', '');
      }
    });
  }
</script>
